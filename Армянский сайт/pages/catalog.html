<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Каталог рецептов - Armenian Flavors</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        .catalog-page {
            padding: 40px 0;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .page-header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .category-section {
            margin-bottom: 60px;
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        .category-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 25px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .category-header h2 {
            color: white;
            margin: 0;
            font-size: 1.8rem;
        }
        
        .category-count {
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .category-content {
            padding: 40px;
        }
        
        .recipes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .recipe-card {
            background: #f9f9f9;
            border-radius: var(--radius);
            overflow: hidden;
            transition: var(--transition);
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .recipe-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
        }
        
        .recipe-content {
            padding: 25px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .recipe-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--text-color);
        }
        
        .recipe-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .recipe-meta span {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .recipe-description {
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 20px;
            flex: 1;
        }
        
        .recipe-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
        }
        
        .recipe-rating {
            color: #ffc107;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .no-recipes {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }
        
        .no-recipes i {
            font-size: 48px;
            margin-bottom: 20px;
            color: var(--border-color);
        }
        
        .catalog-nav {
            position: sticky;
            top: 100px;
            background: white;
            padding: 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }
        
        .catalog-nav h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .nav-categories {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .nav-categories li {
            margin-bottom: 10px;
        }
        
        .nav-categories a {
            display: block;
            padding: 10px 15px;
            color: var(--text-color);
            text-decoration: none;
            border-radius: var(--radius);
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-categories a:hover {
            background: var(--primary-color);
            color: white;
        }
        
        .nav-categories a:hover .nav-count {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .nav-count {
            background: var(--bg-light);
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            color: var(--text-light);
        }
        
        .category-icon {
            width: 50px;
            height: 50px;
            background: rgba(211, 47, 47, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: var(--primary-color);
            font-size: 1.2rem;
        }
        
        .category-title-wrapper {
            display: flex;
            align-items: center;
        }
        
        .category-description {
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-top: 10px;
            max-width: 600px;
        }
        
        .quick-filters {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .filter-chip {
            padding: 8px 16px;
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .filter-chip:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        
        .filter-chip.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .difficulty-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .difficulty-easy {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .difficulty-medium {
            background: #fff3e0;
            color: #ef6c00;
        }
        
        .difficulty-hard {
            background: #ffebee;
            color: #c62828;
        }
        
        @media (max-width: 768px) {
            .recipes-grid {
                grid-template-columns: 1fr;
            }
            
            .category-header {
                padding: 20px;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .category-content {
                padding: 20px;
            }
            
            .quick-filters {
                justify-content: center;
            }
        }
        
        .catalog-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 40px;
        }
        
        @media (max-width: 992px) {
            .catalog-container {
                grid-template-columns: 1fr;
            }
            
            .catalog-nav {
                position: static;
                margin-bottom: 20px;
            }
        }
        
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
        }
        
        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .back-to-top:hover {
            background: var(--primary-dark);
            transform: translateY(-3px);
        }
    </style>
</head>
<body>
    <!-- Шапка -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="../index.html" class="logo">
                    <i class="fas fa-utensils"></i>
                    <span>Armenian Flavors</span>
                </a>
                
                <div class="nav-menu">
                    <a href="../index.html" class="nav-link">Главная</a>
                    <a href="catalog.html" class="nav-link active">Каталог рецептов</a>
                    <a href="add-recipe.html" class="nav-link">Добавить рецепт</a>
                    <a href="about.html" class="nav-link">О нас</a>
                </div>
                
                <div class="nav-actions">
                    <a href="auth.html" class="btn btn-outline" id="authBtn">
                        <i class="fas fa-user"></i>
                        <span>Войти</span>
                    </a>
                    <a href="profile.html" class="btn btn-primary hidden" id="profileBtn">
                        <i class="fas fa-user-circle"></i>
                        <span>Профиль</span>
                    </a>
                </div>
                
                <button class="menu-toggle" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
            </nav>
        </div>
    </header>

    <!-- Основное содержимое -->
    <main class="container catalog-page">
        <div class="page-header">
            <h1>Каталог армянских рецептов</h1>
            <p>Традиционные блюда армянской кухни, собранные в одном месте</p>
        </div>

        <div class="catalog-container">
            <!-- Навигация по категориям -->
            <nav class="catalog-nav">
                <h3>Категории блюд</h3>
                <ul class="nav-categories" id="navCategories">
                    <!-- Категории будут загружены через JavaScript -->
                </ul>
                
                <h3 style="margin-top: 30px;">Быстрая фильтрация</h3>
                <div class="quick-filters">
                    <span class="filter-chip" data-difficulty="Легкая">Легкие</span>
                    <span class="filter-chip" data-difficulty="Средняя">Средние</span>
                    <span class="filter-chip" data-difficulty="Сложная">Сложные</span>
                    <span class="filter-chip" data-time="60">До 1 часа</span>
                    <span class="filter-chip" data-time="30">До 30 минут</span>
                </div>
            </nav>

            <!-- Основной контент с категориями -->
            <div class="catalog-content">
                <!-- Секция "Супы" -->
                <section class="category-section" id="category-1">
                    <div class="category-header">
                        <div class="category-title-wrapper">
                            <div class="category-icon">
                                <i class="fas fa-utensil-spoon"></i>
                            </div>
                            <div>
                                <h2>Супы</h2>
                                <p class="category-description">Традиционные армянские супы, которые согревают и насыщают. От наваристого хаша до легкого танапура.</p>
                            </div>
                        </div>
                        <span class="category-count" id="count-1">5 рецептов</span>
                    </div>
                    <div class="category-content">
                        <div class="recipes-grid" id="recipes-category-1">
                            <!-- Рецепты категории "Супы" будут загружены через JavaScript -->
                        </div>
                    </div>
                </section>

                <!-- Секция "Основные блюда" -->
                <section class="category-section" id="category-2">
                    <div class="category-header">
                        <div class="category-title-wrapper">
                            <div class="category-icon">
                                <i class="fas fa-drumstick-bite"></i>
                            </div>
                            <div>
                                <h2>Основные блюда</h2>
                                <p class="category-description">Главные блюда армянской кухни: долма, хоровац, кюфта и другие национальные деликатесы.</p>
                            </div>
                        </div>
                        <span class="category-count" id="count-2">15 рецептов</span>
                    </div>
                    <div class="category-content">
                        <div class="recipes-grid" id="recipes-category-2">
                            <!-- Рецепты категории "Основные блюда" будут загружены через JavaScript -->
                        </div>
                    </div>
                </section>

                <!-- Секция "Выпечка" -->
                <section class="category-section" id="category-3">
                    <div class="category-header">
                        <div class="category-title-wrapper">
                            <div class="category-icon">
                                <i class="fas fa-bread-slice"></i>
                            </div>
                            <div>
                                <h2>Выпечка</h2>
                                <p class="category-description">Армянский хлеб, лаваш, гата и другие изделия из теста, которые являются основой национальной кухни.</p>
                            </div>
                        </div>
                        <span class="category-count" id="count-3">7 рецептов</span>
                    </div>
                    <div class="category-content">
                        <div class="recipes-grid" id="recipes-category-3">
                            <!-- Рецепты категории "Выпечка" будут загружены через JavaScript -->
                        </div>
                    </div>
                </section>

                <!-- Секция "Закуски" -->
                <section class="category-section" id="category-4">
                    <div class="category-header">
                        <div class="category-title-wrapper">
                            <div class="category-icon">
                                <i class="fas fa-cheese"></i>
                            </div>
                            <div>
                                <h2>Закуски</h2>
                                <p class="category-description">Легкие закуски, салаты и холодные блюда, которые идеально подходят для начала трапезы.</p>
                            </div>
                        </div>
                        <span class="category-count" id="count-4">5 рецептов</span>
                    </div>
                    <div class="category-content">
                        <div class="recipes-grid" id="recipes-category-4">
                            <!-- Рецепты категории "Закуски" будут загружены через JavaScript -->
                        </div>
                    </div>
                </section>

                <!-- Секция "Десерты" -->
                <section class="category-section" id="category-5">
                    <div class="category-header">
                        <div class="category-title-wrapper">
                            <div class="category-icon">
                                <i class="fas fa-ice-cream"></i>
                            </div>
                            <div>
                                <h2>Десерты</h2>
                                <p class="category-description">Сладкие завершения трапезы: пахлава, гата, фруктовые десерты и традиционные сладости.</p>
                            </div>
                        </div>
                        <span class="category-count" id="count-5">7 рецептов</span>
                    </div>
                    <div class="category-content">
                        <div class="recipes-grid" id="recipes-category-5">
                            <!-- Рецепты категории "Десерты" будут загружены через JavaScript -->
                        </div>
                    </div>
                </section>

                <!-- Секция "Напитки" -->
                <section class="category-section" id="category-6">
                    <div class="category-header">
                        <div class="category-title-wrapper">
                            <div class="category-icon">
                                <i class="fas fa-glass-whiskey"></i>
                            </div>
                            <div>
                                <h2>Напитки</h2>
                                <p class="category-description">Традиционные армянские напитки: от освежающего тархуна до полезного мацуна.</p>
                            </div>
                        </div>
                        <span class="category-count" id="count-6">3 рецепта</span>
                    </div>
                    <div class="category-content">
                        <div class="recipes-grid" id="recipes-category-6">
                            <!-- Рецепты категории "Напитки" будут загружены через JavaScript -->
                        </div>
                    </div>
                </section>
            </div>
        </div>
        
        <!-- Кнопка "Наверх" -->
        <div class="back-to-top" id="backToTop">
            <i class="fas fa-chevron-up"></i>
        </div>
    </main>

    <!-- Подвал -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Armenian Flavors</h3>
                    <p>Кулинарный портал армянской кухни</p>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-facebook"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-vk"></i></a>
                        <a href="#"><i class="fab fa-telegram"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Разделы</h4>
                    <a href="../index.html">Главная</a>
                    <a href="catalog.html">Каталог рецептов</a>
                    <a href="add-recipe.html">Добавить рецепт</a>
                    <a href="about.html">О нас</a>
                </div>
                <div class="footer-section">
                    <h4>Помощь</h4>
                    <a href="#">FAQ</a>
                    <a href="#">Контакты</a>
                    <a href="#">Правила сайта</a>
                </div>
                <div class="footer-section">
                    <h4>Контакты</h4>
                    <p><i class="fas fa-envelope"></i> info@armenianflavors.com</p>
                    <p><i class="fas fa-phone"></i> +7 (XXX) XXX-XX-XX</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Armenian Flavors. Все права защищены.</p>
            </div>
        </div>
    </footer>

    <script src="../script.js"></script>
    <script src="../indexedDB.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Инициализируем базу данных
            await window.db.init();
            
            // Проверка авторизации
            checkAuth();
            
            // Загружаем все категории и рецепты
            await loadCategories();
            await loadAllRecipesByCategory();
            
            // Инициализация навигации
            initCategoryNavigation();
            
            // Инициализация быстрых фильтров
            initQuickFilters();
            
            // Инициализация кнопки "Наверх"
            initBackToTop();
            
            // Прокрутка к выбранной категории из URL
            scrollToCategoryFromUrl();
        });
        
        // Функция проверки авторизации
        function checkAuth() {
            const authBtn = document.getElementById('authBtn');
            const profileBtn = document.getElementById('profileBtn');
            const user = window.db?.getCurrentUser?.();
            
            if (user) {
                authBtn?.classList.add('hidden');
                profileBtn?.classList.remove('hidden');
                profileBtn.querySelector('span').textContent = user.login;
            } else {
                authBtn?.classList.remove('hidden');
                profileBtn?.classList.add('hidden');
            }
        }
        
        // Функция загрузки категорий в навигацию
        async function loadCategories() {
            try {
                const categories = await window.db.getAllCategories();
                const navContainer = document.getElementById('navCategories');
                
                if (!navContainer) return;
                
                const categoriesHtml = await Promise.all(categories.map(async category => {
                    // Считаем количество рецептов в категории
                    const recipes = await window.db.getRecipesByCategory(category.id);
                    
                    return `
                        <li>
                            <a href="#category-${category.id}" data-category="${category.id}">
                                ${category.name}
                                <span class="nav-count">${recipes.length}</span>
                            </a>
                        </li>
                    `;
                }));
                
                navContainer.innerHTML = categoriesHtml.join('');
            } catch (error) {
                console.error('Ошибка загрузки категорий:', error);
            }
        }
        
        // Функция загрузки всех рецептов по категориям
        async function loadAllRecipesByCategory() {
            try {
                const categories = await window.db.getAllCategories();
                
                for (const category of categories) {
                    await loadRecipesForCategory(category.id);
                }
            } catch (error) {
                console.error('Ошибка загрузки рецептов по категориям:', error);
            }
        }
        
        // Функция загрузки рецептов для конкретной категории
        async function loadRecipesForCategory(categoryId) {
            try {
                const recipes = await window.db.getRecipesByCategory(categoryId);
                const container = document.getElementById(`recipes-category-${categoryId}`);
                const countElement = document.getElementById(`count-${categoryId}`);
                
                if (!container) return;
                
                // Обновляем счетчик
                if (countElement) {
                    const recipesCount = recipes.length;
                    countElement.textContent = `${recipesCount} рецепт${getPluralEnding(recipesCount)}`;
                }
                
                if (recipes.length === 0) {
                    container.innerHTML = `
                        <div class="no-recipes">
                            <i class="fas fa-utensils"></i>
                            <h3>Пока нет рецептов в этой категории</h3>
                            <p>Будьте первым, кто добавит рецепт!</p>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = await Promise.all(recipes.map(async recipe => {
                    const difficultyClass = getDifficultyClass(recipe.difficulty);
                    
                    return `
                        <div class="recipe-card">
                            <div class="recipe-image">
                                <i class="fas fa-utensils fa-3x"></i>
                            </div>
                            <div class="recipe-content">
                                <h3 class="recipe-title">
                                    ${recipe.title}
                                    <span class="difficulty-badge ${difficultyClass}">${recipe.difficulty}</span>
                                </h3>
                                <div class="recipe-meta">
                                    <span><i class="fas fa-clock"></i> ${recipe.cookingTime} мин</span>
                                    <span><i class="fas fa-eye"></i> ${recipe.views || 0}</span>
                                    <span><i class="fas fa-heart"></i> ${recipe.favorites || 0}</span>
                                </div>
                                <p class="recipe-description">${recipe.description}</p>
                                <div class="recipe-footer">
                                    <div class="recipe-rating">
                                        <i class="fas fa-star"></i>
                                        <span>${recipe.rating?.toFixed(1) || '4.5'}</span>
                                    </div>
                                    <a href="recipe.html?id=${recipe.id}" class="btn btn-primary">
                                        <i class="fas fa-book-open"></i>
                                        <span>Открыть</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    `;
                })).then(html => html.join(''));
            } catch (error) {
                console.error(`Ошибка загрузки рецептов для категории ${categoryId}:`, error);
            }
        }
        
        // Функция для получения правильного окончания слова "рецепт"
        function getPluralEnding(count) {
            if (count % 10 === 1 && count % 100 !== 11) return '';
            if (count % 10 >= 2 && count % 10 <= 4 && (count % 100 < 10 || count % 100 >= 20)) return 'а';
            return 'ов';
        }
        
        // Функция для получения CSS-класса сложности
        function getDifficultyClass(difficulty) {
            switch(difficulty) {
                case 'Легкая': return 'difficulty-easy';
                case 'Средняя': return 'difficulty-medium';
                case 'Сложная': return 'difficulty-hard';
                default: return 'difficulty-medium';
            }
        }
        
        // Инициализация навигации по категориям
        function initCategoryNavigation() {
            const navLinks = document.querySelectorAll('.nav-categories a');
            
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const categoryId = this.dataset.category;
                    const targetElement = document.getElementById(`category-${categoryId}`);
                    
                    if (targetElement) {
                        // Плавная прокрутка к категории
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                        
                        // Подсветка активной категории
                        navLinks.forEach(l => l.classList.remove('active'));
                        this.classList.add('active');
                    }
                });
            });
            
            // Отслеживаем прокрутку для подсветки активной категории
            window.addEventListener('scroll', highlightActiveCategory);
        }
        
        // Подсветка активной категории при прокрутке
        function highlightActiveCategory() {
            const categories = document.querySelectorAll('.category-section');
            const navLinks = document.querySelectorAll('.nav-categories a');
            
            let currentCategory = null;
            let minDistance = Infinity;
            
            // Находим ближайшую к верху экрана категорию
            categories.forEach(category => {
                const rect = category.getBoundingClientRect();
                const distance = Math.abs(rect.top);
                
                if (distance < minDistance) {
                    minDistance = distance;
                    currentCategory = category.id.split('-')[1];
                }
            });
            
            // Подсвечиваем соответствующую ссылку в навигации
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.dataset.category === currentCategory) {
                    link.classList.add('active');
                }
            });
        }
        
        // Инициализация быстрых фильтров
        function initQuickFilters() {
            const filterChips = document.querySelectorAll('.filter-chip');
            
            filterChips.forEach(chip => {
                chip.addEventListener('click', async function() {
                    // Снимаем активный класс со всех чипов
                    filterChips.forEach(c => c.classList.remove('active'));
                    
                    // Добавляем активный класс текущему чипу
                    this.classList.add('active');
                    
                    // Применяем фильтр
                    const difficulty = this.dataset.difficulty;
                    const maxTime = this.dataset.time;
                    
                    await filterRecipesByQuickFilter(difficulty, maxTime);
                });
            });
            
            // Кнопка сброса фильтров
            document.addEventListener('click', async function(e) {
                if (e.target.classList.contains('category-header') || 
                    e.target.closest('.category-header')) {
                    await resetQuickFilters();
                }
            });
        }
        
        // Фильтрация рецептов по быстрому фильтру
        async function filterRecipesByQuickFilter(difficulty, maxTime) {
            try {
                const categories = await window.db.getAllCategories();
                
                for (const category of categories) {
                    let recipes = await window.db.getRecipesByCategory(category.id);
                    
                    // Применяем фильтр по сложности
                    if (difficulty) {
                        recipes = recipes.filter(r => r.difficulty === difficulty);
                    }
                    
                    // Применяем фильтр по времени
                    if (maxTime) {
                        recipes = recipes.filter(r => r.cookingTime <= parseInt(maxTime));
                    }
                    
                    const container = document.getElementById(`recipes-category-${category.id}`);
                    const countElement = document.getElementById(`count-${category.id}`);
                    
                    if (!container) return;
                    
                    // Обновляем счетчик
                    if (countElement) {
                        const recipesCount = recipes.length;
                        countElement.textContent = `${recipesCount} рецепт${getPluralEnding(recipesCount)}`;
                    }
                    
                    if (recipes.length === 0) {
                        container.innerHTML = `
                            <div class="no-recipes">
                                <i class="fas fa-filter"></i>
                                <h3>Нет рецептов по выбранному фильтру</h3>
                                <p>Попробуйте другой фильтр или просмотрите все рецепты категории</p>
                            </div>
                        `;
                        continue;
                    }
                    
                    // Обновляем отображение рецептов
                    container.innerHTML = await Promise.all(recipes.map(recipe => {
                        const difficultyClass = getDifficultyClass(recipe.difficulty);
                        
                        return `
                            <div class="recipe-card">
                                <div class="recipe-image">
                                    <i class="fas fa-utensils fa-3x"></i>
                                </div>
                                <div class="recipe-content">
                                    <h3 class="recipe-title">
                                        ${recipe.title}
                                        <span class="difficulty-badge ${difficultyClass}">${recipe.difficulty}</span>
                                    </h3>
                                    <div class="recipe-meta">
                                        <span><i class="fas fa-clock"></i> ${recipe.cookingTime} мин</span>
                                        <span><i class="fas fa-eye"></i> ${recipe.views || 0}</span>
                                        <span><i class="fas fa-heart"></i> ${recipe.favorites || 0}</span>
                                    </div>
                                    <p class="recipe-description">${recipe.description}</p>
                                    <div class="recipe-footer">
                                        <div class="recipe-rating">
                                            <i class="fas fa-star"></i>
                                            <span>${recipe.rating?.toFixed(1) || '4.5'}</span>
                                        </div>
                                        <a href="recipe.html?id=${recipe.id}" class="btn btn-primary">
                                            <i class="fas fa-book-open"></i>
                                            <span>Открыть</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        `;
                    })).then(html => html.join(''));
                }
            } catch (error) {
                console.error('Ошибка фильтрации рецептов:', error);
            }
        }
        
        // Сброс быстрых фильтров
        async function resetQuickFilters() {
            const filterChips = document.querySelectorAll('.filter-chip');
            filterChips.forEach(chip => chip.classList.remove('active'));
            await loadAllRecipesByCategory();
        }
        
        // Инициализация кнопки "Наверх"
        function initBackToTop() {
            const backToTopBtn = document.getElementById('backToTop');
            
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    backToTopBtn.classList.add('visible');
                } else {
                    backToTopBtn.classList.remove('visible');
                }
            });
            
            backToTopBtn.addEventListener('click', function() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        }
        
        // Прокрутка к категории из URL (если есть хэш)
        function scrollToCategoryFromUrl() {
            const hash = window.location.hash;
            if (hash && hash.startsWith('#category-')) {
                const targetElement = document.querySelector(hash);
                if (targetElement) {
                    setTimeout(() => {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }, 100);
                }
            }
        }
    </script>
</body>
</html>